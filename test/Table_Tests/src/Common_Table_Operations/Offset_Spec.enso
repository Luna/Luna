from Standard.Base import all
from Standard.Test import all

from Standard.Database.Errors import Unsupported_Database_Operation
import Standard.Database.Feature.Feature

main filter=Nothing = run_default_backend add_specs filter

add_specs suite_builder setup =
    if setup.is_feature_supported Feature.Offset then (add_offset_specs suite_builder setup) else
        suite_builder.group setup.prefix+"Table.offset" group_builder->
            group_builder.specify "offset should report unsupported" <|
                table_builder = setup.light_table_builder
                t = table_builder [["ix", [1, 2, 3, 4, 5]], ["X", [100, 3, Nothing, 4, 12]], ["Y", [100, 4, 2, Nothing, 11]]]
                t2 = t.offset "X"
                t2.should_fail_with (Unsupported_Database_Operation.Error "offset")
                c = t.at 0
                c2 = c.offset
                c2.should_fail_with (Unsupported_Database_Operation.Error "offset")

add_filter_specs suite_builder setup =
    prefix = setup.prefix
    table_builder = setup.light_table_builder
