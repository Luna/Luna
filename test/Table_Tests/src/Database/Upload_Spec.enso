from Standard.Base import all

from Standard.Database import all
from Standard.Database.Errors import all

from Standard.Test import Test, Test_Suite, Problems
import Standard.Test.Extensions

import project.Database.Helpers.Name_Generator

main = Test_Suite.run_main <|
    spec "[SQLite] " (Database.connect (SQLite In_Memory))

spec prefix make_new_connection =
    connection = make_new_connection Nothing
    Test.group prefix+"Uploading an in-memory Table" <|
        in_memory_table = Table.new [["X", [1, 2, 3]], ["Y", ['a', 'b', 'c']]]
        Test.specify "should include the created table in the tables directory" <|
            db_table = in_memory_table.upload connection (Name_Generator.random_name "permanent_table_1") temporary=False
            Panic.with_finalizer (connection.drop_table db_table.name) <|
                ???

        Test.specify "should include the temporary table in the tables directory" <|
            Error.throw "TODO"

        Test.specify "should drop the temporary table after the connection is closed" <|
            Error.throw "TODO"

        Test.specify "should preserve the regular table after the connection is closed" <|
            Error.throw "TODO"

        Test.specify "should rollback the table creation if upload fails" <|
            Error.throw "TODO"

type Exploding_Mock_Column
    Value (values:Vector)
