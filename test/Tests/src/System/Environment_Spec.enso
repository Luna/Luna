from Standard.Base import all

import Standard.Base.System.Environment
import Standard.Test

spec = Test.group "Environment" <|
    Test.specify "should allow to internally override environment variables for testing purposes" <|
        old = Environment.get "foobar"

        result_0 = Environment.unsafe_with_environment_override "foobar" "value1" 23
        result_0 . should_equal 23

        result_1 = Environment.unsafe_with_environment_override "foobar" "value1" <|
            Environment.get "foobar" . should_equal "value1"
            42
        result_2 = Environment.unsafe_with_environment_override "foobar" "other interesting value" <|
            Environment.get "foobar"

        result_1 . should_equal 42
        result_2 . should_equal "other interesting value"
        Environment.get "foobar" . should_equal old

main = Test.Suite.run_main spec
