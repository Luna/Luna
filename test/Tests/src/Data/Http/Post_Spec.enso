from Standard.Base import all

from Standard.Test import Test, Test_Suite
import Standard.Test.Extensions

polyglot java import java.lang.System as Java_System

spec =
    base_url = Java_System.getenv "ENSO_HTTP_TEST_HTTPBIN_URL"
    pending_has_url = if base_url != Nothing then Nothing else
        "The POST tests only run when the `ENSO_HTTP_TEST_HTTPBIN_URL` environment variable is set to URL of the httpbin server"

    Test.group "json" pending=pending_has_url <|
        base_url_with_slash = if base_url.ends_with "/" then base_url else base_url + "/"

        Test.specify "Can post JSON" <|
            url_get = base_url_with_slash + "get"
            body = '{ "a" : 1 }'
            IO.println 'AAA'
            response = Data.post url_get body
            IO.println response

main = Test_Suite.run_main spec
