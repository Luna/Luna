from Standard.Base import all
from Standard.Test import all

fib n = if n <= 1 then 1 else
    a = fib n-1
    b = fib n-2
    a+b

spec =
    Test.group "Instrument fibonacci" <|
        Test.specify "collect and filter on return updates" <|
            b = Vector.new_builder

            collect uuid:Text result =
                a_plus_b_uuid = "e0ec2989-d6a9-4e0f-a4c4-cca872c18b5f" # UUID for a+b
                if uuid == a_plus_b_uuid then
                    b.append result
                Nothing

            Meta.meta .fib . instrument . on_return collect . activate
            fib 10

            v = b.to_vector

            v.length . should_equal 1
            v.at 0 . should_equal 89

main = Test_Suite.run_main spec



#### METADATA ####
[[{"index":{"value":5},"size":{"value":8}},"4e3ee5de-a962-4736-ba3c-0bb49bd614da"],[{"index":{"value":13},"size":{"value":1}},"8fcd8576-0317-4bac-b8b0-ab20c7c3ecc7"],[{"index":{"value":14},"size":{"value":4}},"b5d71a33-ca4b-4d8d-bed2-67990cfff9d9"],[{"index":{"value":5},"size":{"value":13}},"e4109f61-fcba-4181-a9eb-96e822ac8339"],[{"index":{"value":0},"size":{"value":29}},"ce9bd6b0-8fdb-410c-bd90-9f1823176a82"],[{"index":{"value":35},"size":{"value":8}},"91d5f418-9ded-4ac0-b934-ef68420e8592"],[{"index":{"value":43},"size":{"value":1}},"c4632a6f-4ca5-46a4-82c9-53703ee12962"],[{"index":{"value":44},"size":{"value":4}},"62068ba6-9396-49bf-9db9-de3bc6c378aa"],[{"index":{"value":35},"size":{"value":13}},"203d1d55-8df7-4648-92f2-e6c3b28022e1"],[{"index":{"value":30},"size":{"value":29}},"d5cfe0ec-6645-482d-b390-b33461940165"],[{"index":{"value":61},"size":{"value":3}},"5ac83555-a00d-4f1c-944e-0b7085b014fa"],[{"index":{"value":65},"size":{"value":1}},"3a3d1f75-15c0-4a02-bc4b-b0b6e9d678a9"],[{"index":{"value":61},"size":{"value":5}},"2998e257-c7ab-4c17-beb3-3a8e8ce8918b"],[{"index":{"value":67},"size":{"value":1}},"02138c36-c016-4d00-bc78-794ed9eacb5a"],[{"index":{"value":72},"size":{"value":1}},"3bca2719-5c96-4b24-bd5f-e1c0f068c2a4"],[{"index":{"value":74},"size":{"value":2}},"e35ca7e8-d987-4f8e-b4e8-db1080ba9f9e"],[{"index":{"value":77},"size":{"value":1}},"e9ff3cc0-eacb-48bf-8a01-58ac22f987b8"],[{"index":{"value":72},"size":{"value":6}},"c0d0a239-b159-4509-baee-1763b8f0501b"],[{"index":{"value":84},"size":{"value":1}},"1da4a39f-d10a-4c94-94ad-59c78a1bbc46"],[{"index":{"value":95},"size":{"value":1}},"9009fb49-0ee5-4591-a877-e9ab5060e5f2"],[{"index":{"value":97},"size":{"value":1}},"107a3ab1-99fa-46f3-9dc5-cd1ef9be1e28"],[{"index":{"value":99},"size":{"value":3}},"fb02bbae-994f-4bb6-8145-24206a02df41"],[{"index":{"value":103},"size":{"value":1}},"9f9d0a1e-aa60-4948-ad6a-fca8157cf009"],[{"index":{"value":104},"size":{"value":1}},"36d6cf91-9e67-402b-b165-38ee28dd0a50"],[{"index":{"value":105},"size":{"value":1}},"64052667-4133-401d-a106-6092f5f00fe5"],[{"index":{"value":103},"size":{"value":3}},"38106744-b9ba-487f-91e5-538072b5cfc5"],[{"index":{"value":99},"size":{"value":7}},"da8d193c-7abf-4cc0-adca-bbba2c872b53"],[{"index":{"value":95},"size":{"value":11}},"4fbfdb50-3339-4104-aee0-292a13ffcb69"],[{"index":{"value":111},"size":{"value":1}},"a124de72-c2a4-4222-9f70-bb9688c18ed1"],[{"index":{"value":113},"size":{"value":1}},"543b8e2e-ca31-446b-a5d9-93ac4d301ef9"],[{"index":{"value":115},"size":{"value":3}},"3a8b9ba5-4382-481f-8c76-f99e5d8b266a"],[{"index":{"value":119},"size":{"value":1}},"f8ca7c08-62d1-4317-afad-e36b1de2cfa1"],[{"index":{"value":120},"size":{"value":1}},"87044f7b-a812-46ec-8d34-2024f7b8ed6e"],[{"index":{"value":121},"size":{"value":1}},"224a9608-35c1-4c15-95be-7099d78acca4"],[{"index":{"value":119},"size":{"value":3}},"da47f7b6-b118-4a5c-9799-94deee416d32"],[{"index":{"value":115},"size":{"value":7}},"22eb1656-2688-4553-af1f-1dc237342035"],[{"index":{"value":111},"size":{"value":11}},"fec0e605-49cb-4d9f-a4e6-27f297f075fe"],[{"index":{"value":127},"size":{"value":1}},"a9b772b8-ca76-452a-a704-c0d09f8541f9"],[{"index":{"value":128},"size":{"value":1}},"bced34d7-5985-4af1-9c5b-a48ba14f2714"],[{"index":{"value":129},"size":{"value":1}},"99bb3056-9377-478b-8da2-7cff11c2a19b"],[{"index":{"value":127},"size":{"value":3}},"e0ec2989-d6a9-4e0f-a4c4-cca872c18b5f"],[{"index":{"value":90},"size":{"value":40}},"6bb3ab5d-53ba-493f-b101-532cbe01c1fe"],[{"index":{"value":69},"size":{"value":61}},"3f803648-fcd1-4535-b5b7-0acabdc36624"],[{"index":{"value":61},"size":{"value":69}},"40ae1ae0-03ce-4d07-ae46-5d206b7686b4"],[{"index":{"value":132},"size":{"value":4}},"ff4148a2-17a0-4d8b-b571-a9e192e180bc"],[{"index":{"value":137},"size":{"value":1}},"833497de-8c38-4b47-b849-0224e59fd795"],[{"index":{"value":143},"size":{"value":4}},"e988d42b-3e2e-42d0-8a44-259f80b9c4c3"],[{"index":{"value":147},"size":{"value":1}},"78b0ae35-7485-430e-b08f-ef3370f4f541"],[{"index":{"value":148},"size":{"value":5}},"337f7853-cbeb-481c-aed0-17ea98ac3625"],[{"index":{"value":143},"size":{"value":10}},"d2dc5b81-014b-46b2-9a99-dea1a9580b9d"],[{"index":{"value":154},"size":{"value":22}},"8e1a23b1-3586-42e8-a994-9ca90d5c1e3e"],[{"index":{"value":143},"size":{"value":33}},"7fe8167c-0d0b-4a1d-b91f-e8817f712ea4"],[{"index":{"value":177},"size":{"value":2}},"fd9f3285-cd2b-407d-941a-19048d9fa2d2"],[{"index":{"value":188},"size":{"value":4}},"40285026-200f-4cd3-89ee-68877ed3db63"],[{"index":{"value":192},"size":{"value":1}},"6bbf03ac-2cae-480b-b324-b872513d15a9"],[{"index":{"value":193},"size":{"value":7}},"a3b4b3aa-5604-4160-a3d1-1d5891ae8769"],[{"index":{"value":188},"size":{"value":12}},"42735fb7-69aa-44d8-9d17-acb0b21324b8"],[{"index":{"value":201},"size":{"value":25}},"bcc6087d-1968-412d-aff9-3f049bf16dc8"],[{"index":{"value":188},"size":{"value":38}},"b78c6f95-ef86-4f4c-b8c4-dff4c04c5441"],[{"index":{"value":227},"size":{"value":2}},"0ca3cf81-103a-4f09-a616-347421825551"],[{"index":{"value":242},"size":{"value":1}},"67caed0d-ecdf-467b-90bd-beea88c36e25"],[{"index":{"value":244},"size":{"value":1}},"af6e069d-4c64-4656-bbce-f36eb1033b50"],[{"index":{"value":246},"size":{"value":6}},"a1e7a036-8661-4270-bc47-42c2d21feab5"],[{"index":{"value":252},"size":{"value":1}},"841a95f3-41b9-4505-9bf8-d4229a5edac7"],[{"index":{"value":253},"size":{"value":11}},"ef88bb50-a846-47f5-ae24-70e0afc449af"],[{"index":{"value":246},"size":{"value":18}},"199abcc4-c9c3-4c31-9d36-24f5167674e3"],[{"index":{"value":242},"size":{"value":22}},"03eb0272-2ee4-48dc-b1fa-48583c93db60"],[{"index":{"value":278},"size":{"value":7}},"a19b98f8-98ca-4a7b-afc5-39a523c90167"],[{"index":{"value":286},"size":{"value":1}},"d7608f8e-f911-4ebd-8c0d-78441a3f78c5"],[{"index":{"value":287},"size":{"value":1}},"aa7e033d-a610-458f-88de-0a3a06328515"],[{"index":{"value":288},"size":{"value":4}},"652f12de-b261-4f3d-891f-f70e455f76d8"],[{"index":{"value":286},"size":{"value":6}},"eea8772c-6034-41b6-b324-6a1b958b0f3f"],[{"index":{"value":278},"size":{"value":14}},"6d71046a-4c17-489b-a97c-0d3f57e1392f"],[{"index":{"value":293},"size":{"value":6}},"38b71961-ad32-478d-a340-4e8da4d3691a"],[{"index":{"value":278},"size":{"value":21}},"2adf5a63-7711-43a5-9e71-18b717461519"],[{"index":{"value":300},"size":{"value":1}},"636f1cd9-29f3-4adf-932a-3833bba03cce"],[{"index":{"value":318},"size":{"value":1}},"6afa44ba-9197-41a4-92ba-29165ebdcfcf"],[{"index":{"value":319},"size":{"value":1}},"c5bf3cfa-1f50-41f2-9282-464da9ee0fa6"],[{"index":{"value":320},"size":{"value":6}},"55cde97c-6a55-4410-939f-2d4f8c21f3c6"],[{"index":{"value":318},"size":{"value":8}},"bfe1c959-88a1-46b7-bf10-5a0e0449456a"],[{"index":{"value":327},"size":{"value":6}},"58d8c73a-e841-4be5-9a45-3ab4795b63ee"],[{"index":{"value":318},"size":{"value":15}},"d92e1327-9de9-4437-96ab-039d8edd6756"],[{"index":{"value":350},"size":{"value":7}},"86e8f220-8f79-4c5f-874c-df885504aad5"],[{"index":{"value":301},"size":{"value":56}},"972c987b-82d4-491c-9b19-85af8b4c3310"],[{"index":{"value":278},"size":{"value":79}},"f06639dd-cad0-46ad-9db8-1740ecb0709b"],[{"index":{"value":371},"size":{"value":4}},"6f3d7116-da07-43b2-9176-4f61f297003b"],[{"index":{"value":375},"size":{"value":1}},"fef509a2-f1b1-44d1-ac66-6ee55f2a3c37"],[{"index":{"value":376},"size":{"value":4}},"508cac76-2716-46fb-901c-2ee5414f5a4c"],[{"index":{"value":371},"size":{"value":9}},"ef585af2-6166-4e31-a8d2-385630121543"],[{"index":{"value":381},"size":{"value":1}},"723132c6-c247-4535-9e9a-197f826ce115"],[{"index":{"value":382},"size":{"value":3}},"e9c5067c-eb66-4fcf-9eaf-fdd3a7897730"],[{"index":{"value":381},"size":{"value":4}},"dc18c63c-bb4d-4f8f-992c-77f6e27df909"],[{"index":{"value":371},"size":{"value":14}},"eaad1b39-c290-4822-afed-541f820e78b1"],[{"index":{"value":386},"size":{"value":1}},"c883ad54-708e-4863-a4d2-6d052a67c24d"],[{"index":{"value":388},"size":{"value":10}},"998a7721-a171-4b6b-9869-cd3881bbe534"],[{"index":{"value":371},"size":{"value":27}},"961508db-13a9-4c9f-a238-9216e88a116c"],[{"index":{"value":399},"size":{"value":1}},"dc7cdc5f-1f70-4948-9ddd-972369bf12c7"],[{"index":{"value":401},"size":{"value":9}},"24e6f315-74c2-4afd-b72e-6f09af0c120f"],[{"index":{"value":371},"size":{"value":39}},"33ab389e-2ce4-4de9-bc8a-97c28947951a"],[{"index":{"value":411},"size":{"value":7}},"ab8256e5-9d95-4cc6-8b4f-b76f8b0d17eb"],[{"index":{"value":371},"size":{"value":47}},"6ec723dd-9beb-46b7-837a-e08466c533ef"],[{"index":{"value":419},"size":{"value":1}},"a203a50d-962d-47c3-a25c-acec37bd123b"],[{"index":{"value":421},"size":{"value":8}},"fc286adf-feb3-4234-bac3-501b49856bd9"],[{"index":{"value":371},"size":{"value":58}},"140af0b4-55e1-438f-9b0d-1260825ed23a"],[{"index":{"value":442},"size":{"value":3}},"070106e4-b6d9-444f-9069-3769c5914371"],[{"index":{"value":446},"size":{"value":2}},"cbd5f24b-e0e6-4fed-a110-ac64dc05a23a"],[{"index":{"value":442},"size":{"value":6}},"b6355690-8338-4ec0-89e0-aa49fcd1fd70"],[{"index":{"value":462},"size":{"value":1}},"66d76daa-24b7-4437-81c9-b4c10020f332"],[{"index":{"value":464},"size":{"value":1}},"1d8c732b-b6a9-4a59-bce9-82496165461e"],[{"index":{"value":466},"size":{"value":1}},"e7925c94-023b-4ed2-957f-a8b6db2909fe"],[{"index":{"value":467},"size":{"value":1}},"2143c5e7-71c3-4bd0-80d2-4cce29658186"],[{"index":{"value":468},"size":{"value":9}},"39a51c24-5464-4567-a1d5-c1871cd41bcb"],[{"index":{"value":466},"size":{"value":11}},"99064cac-eb49-44aa-aa66-dd5d8c031cca"],[{"index":{"value":462},"size":{"value":15}},"70f7423b-e022-4009-af21-03c8279e5a4e"],[{"index":{"value":491},"size":{"value":1}},"083af372-2c53-4c4f-b56d-8ebbe20c8ac1"],[{"index":{"value":492},"size":{"value":1}},"ef714cf5-3f10-4b72-bf8d-3054300c31ab"],[{"index":{"value":493},"size":{"value":6}},"edbc6235-329b-4297-8fef-28b6366d0341"],[{"index":{"value":491},"size":{"value":8}},"d8af4b86-8969-47d4-b489-56f0d0e0a824"],[{"index":{"value":500},"size":{"value":1}},"8e124843-7d02-421a-b791-7a329b42acab"],[{"index":{"value":502},"size":{"value":12}},"bd83091b-eb87-4ad4-9a4d-a7079063aa32"],[{"index":{"value":491},"size":{"value":23}},"6b8258fb-d5e4-418f-bc69-bd48297c7a80"],[{"index":{"value":515},"size":{"value":1}},"db163828-820f-4c83-96a5-979512c167b1"],[{"index":{"value":491},"size":{"value":25}},"13afce1a-8a2c-4806-8b6e-60cb2ba7f5c6"],[{"index":{"value":229},"size":{"value":287}},"3db461c4-e2c2-4d5a-89b1-0aae6a5301df"],[{"index":{"value":188},"size":{"value":328}},"38d4cb54-a980-402f-a301-6661d9892f73"],[{"index":{"value":179},"size":{"value":337}},"183cc650-8c36-4ed7-8311-cfb4ba6814b0"],[{"index":{"value":143},"size":{"value":373}},"67cfd8ac-1caa-4d5b-ad12-265bd1d490e2"],[{"index":{"value":138},"size":{"value":378}},"993e8bff-692b-4f03-8061-a1b1a2e9e5aa"],[{"index":{"value":132},"size":{"value":384}},"7917a880-bbcc-4865-8cc7-ff76d756dcdd"],[{"index":{"value":518},"size":{"value":4}},"716ac118-2af7-478d-97de-f62905e5eb9c"],[{"index":{"value":523},"size":{"value":1}},"0fde7382-6b86-4a0c-9557-123739d2dd5d"],[{"index":{"value":525},"size":{"value":10}},"7483f497-4244-4208-9a34-bb92d2f1cedb"],[{"index":{"value":535},"size":{"value":1}},"60ec2aa4-036b-4bb5-8b16-0c9a8682b168"],[{"index":{"value":536},"size":{"value":8}},"8e7d78da-3b64-4b57-acb2-9f4f1a25cb58"],[{"index":{"value":525},"size":{"value":19}},"648ad48a-71dc-4daf-a69f-c51b712afb51"],[{"index":{"value":545},"size":{"value":4}},"bd689e93-182c-4e76-b664-a8752818638a"],[{"index":{"value":525},"size":{"value":24}},"babd9fad-03cc-4e5a-9055-536564f648a7"],[{"index":{"value":518},"size":{"value":31}},"3ece1163-a450-4d4a-8321-b87dec02b5fa"],[{"index":{"value":0},"size":{"value":550}},"4395e1d6-f31a-4ff8-a586-777cff8c8f9e"]]
{"ide":{"node":{},"import":{},"project":null}}