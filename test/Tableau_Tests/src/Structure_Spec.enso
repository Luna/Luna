from Standard.Base import all

from Standard.Tableau import Hyper_File

from Standard.Test import all

main filter=Nothing =
    suite = Test.build suite_builder->
        add_specs suite_builder
    suite.run_with_filter filter

add_specs suite_builder = suite_builder.group "Structure" group_builder->
    names_file = enso_project.data / "names.hyper"

    group_builder.specify "should default to all schema" <|
        Hyper_File.new names_file . schema . should_equal "*"

    group_builder.specify "should be able to list schema" <|
        schemas = Hyper_File.new names_file . schemas
        schemas.should_equal ["public", "Extract"]

    group_builder.specify "should default to set schema" <|
        Hyper_File.new names_file schema="Extract" . schema . should_equal "Extract"
        Hyper_File.new names_file . set_schema "Extract" . schema . should_equal "Extract"

    group_builder.specify "should be able to list table" <|
        tables = Hyper_File.new names_file . tables
        tables.length.should_equal 1
        tables.first.schema.should_equal "Extract"
        tables.first.table.should_equal "Extract"

        tables_2 = Hyper_File.new names_file schema="Extract" . tables
        tables_2.length.should_equal 1
        tables_2.first.schema.should_equal "Extract"
        tables_2.first.table.should_equal "Extract"

        tables_3 = Hyper_File.new names_file schema="public" . tables
        tables_3.length.should_equal 0
