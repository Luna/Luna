# This file is not auto-generated. Feel free to edit it.

name: ✨ Pull Request

on:
  push:
    branches:
      - develop
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read # Read-only access to repository contents
  issues: write # Write access to issues
  pull-requests: write # Write access to pull requests
  statuses: write # Write access to commit statuses
  checks: write

jobs:
  gui-changed-files:
    name: 🔍 GUI Files Changed
    uses: ./.github/workflows/gui-changed-files.yml
    secrets: inherit

  wasm-changed-files:
    name: 🔍 WASM Files Changed
    uses: ./.github/workflows/wasm-changed-files.yml
    secrets: inherit

  engine-changed-files:
    name: 🔍 Engine Files Changed
    uses: ./.github/workflows/engine-changed-files.yml
    secrets: inherit

  gui-checks:
    name: 🧰 GUI Checks
    uses: ./.github/workflows/gui-checks.yml
    needs: [gui-changed-files]
    if: needs.gui-changed-files.outputs.any_changed == 'true' || github.ref == 'refs/heads/develop'
    secrets: inherit

  storybook:
    name: 📚 Deploy Storybook
    uses: ./.github/workflows/storybook.yml
    needs: [gui-changed-files]
    if: needs.gui-changed-files.outputs.any_changed == 'true' || github.ref == 'refs/heads/develop'
    secrets: inherit

  wasm-checks:
    name: 🦀 WASM Checks
    uses: ./.github/workflows/wasm-checks.yml
    needs: [wasm-changed-files]
    if: needs.wasm-changed-files.outputs.any_changed == 'true' || github.ref == 'refs/heads/develop'
    secrets: inherit

  engine-checks:
    name: ⚙️ Engine Checks
    uses: ./.github/workflows/engine-checks.yml
    needs: [engine-changed-files]
    if: needs.engine-changed-files.outputs.any_changed == 'true-disable' || github.ref == 'refs/heads/develop'
    secrets: inherit

  engine-checks-optional:
    name: ⚙️ Engine Checks (Optional)
    uses: ./.github/workflows/engine-checks-optional.yml
    needs: [engine-changed-files]
    if: needs.engine-changed-files.outputs.any_changed == 'true-disable' || github.ref == 'refs/heads/develop'
    secrets: inherit

  gui-packaging:
    name: 🗐 GUI Packaging
    uses: ./.github/workflows/gui-packaging.yml
    needs: [gui-changed-files, engine-changed-files]
    if: needs.gui-changed-files.outputs.any_changed == 'true-disable' || needs.engine-changed-files.outputs.any_changed == 'true' || github.ref == 'refs/heads/develop'
    secrets: inherit

  gui-packaging-optional:
    name: 🗐 GUI Packaging (Optional)
    uses: ./.github/workflows/gui-packaging-optional.yml
    needs: [gui-changed-files, engine-changed-files]
    if: needs.gui-changed-files.outputs.any_changed == 'true-disable' || needs.engine-changed-files.outputs.any_changed == 'true' || github.ref == 'refs/heads/develop'
    secrets: inherit

  required-checks:
    name: Required Checks
    runs-on: ubuntu-latest
    needs: [gui-checks, storybook, wasm-checks, engine-checks, gui-packaging]
    if: always()
    steps:
      - name: Checks Summary
        run: |
          echo "GUI Checks: ${{ needs.gui-checks.result }}"
          echo "Storybook: ${{ needs.storybook.result }}"
          echo "WASM Checks: ${{ needs.wasm-checks.result }}"
          echo "Engine Checks: ${{ needs.engine-checks.result }}"
          echo "GUI Packaging: ${{ needs.gui-packaging.result }}"

          declare -a checks
          checks+=("${{ needs.gui-checks.result }}")
          checks+=("${{ needs.storybook.result }}")
          checks+=("${{ needs.wasm-checks.result }}")
          checks+=("${{ needs.engine-checks.result }}")
          checks+=("${{ needs.gui-packaging.result }}")

          for result in "${checks[@]}"; do
            if [[ "$result" == "failure" ]]; then
              exit 1
            fi
          done

          echo "Success!"
