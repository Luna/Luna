import project.Data.Text.Text
import project.Errors.Problem_Behavior.Problem_Behavior
import project.Network.HTTP.HTTP
import project.Network.HTTP.HTTP_Method.HTTP_Method
import project.Network.HTTP.Request.Request
import project.Nothing.Nothing
from project.Enso_Cloud.Data_Link import parse_format, parse_secure_value
from project.Enso_Cloud.Public_Utils import get_optional_field, get_required_field

## PRIVATE
type HTTP_Fetch_Data_Link
    ## PRIVATE
    Value (request : Request) format

    ## PRIVATE
    parse json -> HTTP_Fetch_Data_Link =
        uri = get_required_field "uri" json expected_type=Text
        method = HTTP_Method.from (get_required_field "method" json expected_type=Text)
        format = parse_format (get_optional_field "format" json)
        # TODO headers
        headers = []
        request = Request.new method uri headers
        HTTP_Fetch_Data_Link.Value request format

    ## PRIVATE
    read self (on_problems : Problem_Behavior) =
        _ = on_problems
        response = HTTP.new.request self.request
        response.decode self.format
